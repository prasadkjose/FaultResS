<!DOCTYPE html>
<html lang="en">
        <meta charset="utf-8">


{{> header}}
 
    <link rel="stylesheet" href="/device.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
<script  type="text/javascript">
</script> 


 <body>
     <div class="container body1">
         <center>
         <div class="main well">
             <div>
                 <center>
                 <h1>Controller for {{line}} - {{line_no}}</h1>
                 </center> <br><br><br>
             </div>
             <div class="row">
                 <div class="col-md-3 col-xs-3">
                     {{!-- <form method="POST" action="/device/mqtt">  --}}
                        {{!-- <input type="hidden" value="hi" name="a" /> --}}
                  <a id="SD"><button id="primary-button " >.</button></a>      

                     {{!-- </form> --}}
                    <h4 id="SDh1">Screw Driver</h4>
                 </div>
                 <div class="col-md-3 col-xs-3">
                  <a id="JF"><button id="primary-button " >.</button></a>      
                    <h4>Jig And Fixture</h4>

                 </div>
                 <div class="col-md-3 col-xs-3">
                  <a id="machine"><button id="primary-button " >.</button></a>      
                    <h4>Machine</h4>

                 </div>
                 <div class="col-md-3 col-xs-3">
                  <a id="fitting"><button id="primary-button " >.</button></a>      
                    <h4>Fitting</h4>

                 </div>
             </div>

         </div>
         <div class="ack-div">
               <div class="container well">
                   <h3>Acknowledgement Message from Technician</h3>
                   <div class="ack-well">
                       <div id="messages">
                           <p id="msgs" ></p>
                       </div>
                   </div>
               </div> 

         </div>
         
         </center>
 {{line}}
 {{line_no}}
      </div>
 </body>

 <script>
   var line=  "{{line}}";
 var line_no= "{{line_no}}";

      var es = new EventSource("/device/mqtt-ack/"+line+"/"+line_no);
      es.onerror = function(e)  { console.error(e); };
      es.onopen = function(e) { console.log("Open", e);};
      es.onmessage = function(e) {
        console.log("Mesage:", e);
        var target = document.getElementById("msgs");
        target.textContent = e.data;
      };


 // for screwDriver
     $("#SD").on('click', (event) => {
            event.preventDefault();
            // Getting the values
             let data = {
                 topic : line+"/"+line_no+"/Screw Driver" 

             } 
           
            // Sending to our server
            $.ajax({
                url:"/device/mqtt",
                method:"POST",
                data: data
                 
            })
            
        
            .catch((err) => {
                console.log(err);
            });
        });

 // for Jig and fixture

        $("#JF").on('click', (event) => {
            event.preventDefault();
           
            // Getting the values
             let data = {
                 topic : line+"/"+line_no+"/Jig and Fixture" 

             } 
           
            // Sending to our server
            $.ajax({
                url:"/device/mqtt",
                method:"POST",
                data: data
                
            })
             
            .catch((err) => {
                console.log(err);
            });
        });

 // for machine

        $("#machine").on('click', (event) => {
            event.preventDefault();
           
            // Getting the values
             let data = {
                 topic : line+"/"+line_no+"/Machine" 

             } 
           
            // Sending to our server
            $.ajax({
                url:"/device/mqtt",
                method:"POST",
                data: data
                 
            })
             
            .catch((err) => {
                console.log(err);
            });
        });

 // for fitting

        $("#fitting").on('click', (event) => {
            event.preventDefault();
           
            // Getting the values
             let data = {
                 topic : line+"/"+line_no+"/Fitting" 

             } 
           
            // Sending to our server
            $.ajax({
                url:"/device/mqtt",
                method:"POST",
                data: data
                 
            })
             
            .catch((err) => {
                console.log(err);
            });
        });
</script>

<script>
 
</script>
 
 </html>

{{!-- 
 function loadlink(){
   var  link = "/device/"+line+"/"+line_no+"/mqtt-ack"
    $('#ack').load(link, function () {
   });
}

loadlink(); // This will run on page load
setInterval(function(){
    loadlink() // this will run after every 5 seconds
}, 10000); --}}